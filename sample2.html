<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fthon Interactive: vol.1 - Template</title>
  <link href="stylesheets/lib/sanitize.css" rel="stylesheet" type="text/css"/>
  <link href="stylesheets/common.css" rel="stylesheet" type="text/css"/>
  <script src="javascripts/lib/easeljs-0.8.0.min.js"></script>
</head>

<body onload="init();">
  <canvas id="testCanvas" width="720" height="480"></canvas>

<script>
  var _canvas;
  var _stage;
  var _isMouseDown;
  var _shape;
  var _circlePoint = new createjs.Point(100, 100);
  var _circleV = new createjs.Point(0, 10);
  var _circleA = new createjs.Point(0, 0.98);
  var _circleSize = 20;
  var _circleToSize = 20;
  var _mousePoint = new createjs.Point(0, 0);
  var _oldMousePoint = new createjs.Point(0, 0);

  function init() {
    _canvas = document.getElementById("testCanvas");

    // Stageç”Ÿæˆ
    _stage = new createjs.Stage(_canvas);

    // Stageä¸Šã§ã®ä¸Šã§ã®ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
    _stage.enableMouseOver();
    _stage.addEventListener("stagemousedown", handleMouseDown);
    _stage.addEventListener("stagemouseup", handleMouseUp);
    _stage.addEventListener("stagemousemove", handleMouseMove);

    _shape = new createjs.Shape();
    _stage.addChild(_shape);

    createjs.Ticker.timingMode = createjs.Ticker.RAF;
    createjs.Ticker.addEventListener("tick", tick);
  }

  // ã“ã®é–¢æ•°ã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œ
  function tick(event) {
    //_circlePoint.x = _mousePoint.x;
    //_circlePoint.y = _mousePoint.y;
    if(_isMouseDown){
      _circlePoint.x = _circlePoint.x + (_mousePoint.x - _circlePoint.x)*0.1;
      _circlePoint.y = _circlePoint.y + (_mousePoint.y - _circlePoint.y)*0.1;
    }else{
      //è»Ÿç€é™¸
      //_circlePoint.y = _circlePoint.y + ((_stage.canvas.height - 20) - _circlePoint.y)*0.1;
      //ãƒã‚¦ãƒ³ãƒ‰X
      if(_circlePoint.x <= 0 + _circleSize){
        _circleV.x = - _circleV.x * 0.8;
        _circlePoint.x = 0 + _circleSize;
      }else if(_circlePoint.x >= _stage.canvas.width - _circleSize){
        _circleV.x = - _circleV.x * 0.8;
        _circlePoint.x = _stage.canvas.width - _circleSize;
      }else{
        _circleV.x = (_circleV.x+_circleA.x)*0.97;
      }
      //ãƒã‚¦ãƒ³ãƒ‰Y
      if(_circlePoint.y >= _stage.canvas.height - _circleSize){
        _circleV.y = - _circleV.y * 0.8;
        //ã´ãã´ãå¯¾ç­–
        if(Math.abs(_circleV.y)<3){
          _circleV.y = 0;
        }
        _circlePoint.y = _stage.canvas.height - _circleSize;
      }else{
        _circleV.y = (_circleV.y+_circleA.y)*0.97;
      }

      //console.log(_circleV.y);

      _circlePoint.x += _circleV.x;
      _circlePoint.y += _circleV.y;
    }

    _circleSize = _circleSize + (_circleToSize - _circleSize)*0.5;

    _shape.graphics.clear();
    // beginFill(è‰²) : ä½•è‰²ã§å¡—ã‚Šã¤ã¶ã™ï¼Ÿ
    _shape.graphics.beginFill("#000000");
    // drawCircle(x, y, ç›´å¾„) : å††ã‚’æç”»
    _shape.graphics.drawCircle(_circlePoint.x, _circlePoint.y, _circleSize);

    //ã“ã‚Œã‚’å®Ÿè¡Œã—ãªã„ã¨å®Ÿè¡Œã—ãªã„ã¨æç”»å†…å®¹ãŒæ›´æ–°ã•ã‚Œãªã„ã‚¾ï¼ğŸ˜©
    _stage.update();
  }

  function handleMouseDown(event) {
    _circleToSize = 100;
    _isMouseDown = true;
    _circleV.x = 0;
    _circleV.y = 0;
  }
  function handleMouseUp(event) {
    _circleToSize = 20;
    _isMouseDown = false;
  }
  function handleMouseMove(event) {
    _mousePoint.x = _stage.mouseX;
    _mousePoint.y = _stage.mouseY;
    if(_isMouseDown){
      _circleV.x = (_circleV.x + (_mousePoint.x - _oldMousePoint.x))*0.5;
      _circleV.y = (_circleV.y + (_mousePoint.y - _oldMousePoint.y))*0.5;
    }
    _oldMousePoint.x = _mousePoint.x;
    _oldMousePoint.y = _mousePoint.y;
  }



</script>

</body>
</html>
